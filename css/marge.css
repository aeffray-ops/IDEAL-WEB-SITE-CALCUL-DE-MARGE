/* ========================================
   OUTIL CALCUL DE MARGE — STYLES
   Layout pleine page : sidebar + contenu
======================================== */

/* ---- PAGE ---- */
.marge-page {
  font-family: 'Poppins', sans-serif;
  background: #f0f2f5;
  min-height: 100vh;
  padding: 0;
}

/* ---- LAYOUT PRINCIPAL (sidebar + main) ---- */
.marge-container {
  display: flex;
  width: 100%;
  max-width: none;
  min-height: calc(100vh - 52px);
  margin: 0;
  gap: 0;
}

/* ========================================
   SIDEBAR HISTORIQUE (dark, sticky)
======================================== */
.marge-historique {
  width: 270px;
  min-width: 270px;
  background: #1e293b;
  color: #fff;
  display: flex;
  flex-direction: column;
  position: sticky;
  top: 52px;
  height: calc(100vh - 52px);
  overflow-y: auto;
  border-radius: 0;
  box-shadow: none;
  padding: 0;
  z-index: 10;
}

.marge-historique h3 {
  font-size: 15px;
  font-weight: 700;
  color: #fff;
  padding: 20px 18px 14px;
  margin: 0;
  border-bottom: 1px solid #334155;
  letter-spacing: 0.3px;
}

.marge-historique-list {
  list-style: none;
  padding: 10px;
  margin: 0;
  flex: 1;
  overflow-y: auto;
}

.marge-historique-item {
  padding: 12px 14px;
  border: none;
  border-radius: 8px;
  margin-bottom: 6px;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 13px;
  background: #334155;
  color: #fff;
}

.marge-historique-item:hover {
  background: #475569;
  transform: translateX(3px);
}

.marge-historique-item .nom { font-weight: 600; color: #fff; }
.marge-historique-item .ville { color: rgba(255,255,255,0.55); font-size: 12px; }
.marge-historique-item .date { font-size: 11px; color: rgba(255,255,255,0.35); }

.marge-historique-item .decision {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 700;
  margin-top: 4px;
}

.marge-historique-item .decision.no-go { background: #fecaca; color: #991b1b; }
.marge-historique-item .decision.reflexion,
.marge-historique-item .decision.reflexion2,
.marge-historique-item .decision.orange { background: #fef3c7; color: #92400e; }
.marge-historique-item .decision.go { background: #bbf7d0; color: #166534; }

.marge-historique-actions { display: flex; gap: 5px; margin-top: 8px; }
.marge-historique-actions button {
  padding: 4px 8px;
  font-size: 11px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  background: rgba(255,255,255,0.12);
  color: #cbd5e1;
  transition: all 0.15s;
}
.marge-historique-actions button:hover { background: #6D071A; color: #fff; }

/* ========================================
   CALCULATEUR (zone droite)
======================================== */
.marge-calculateur {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow-x: hidden;
  background: #f0f2f5;
  border-radius: 0;
  box-shadow: none;
  padding: 0;
  min-width: 0;
}

/* ---- TABS ---- */
.marge-tabs {
  display: flex;
  gap: 0;
  padding: 0 28px;
  background: #fff;
  border-bottom: 2px solid #e5e7eb;
  margin-bottom: 0;
}

.marge-tab {
  padding: 14px 24px;
  border: none;
  background: none;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  color: #6b7280;
  border-bottom: 3px solid transparent;
  margin-bottom: -2px;
  transition: all 0.2s;
  font-family: inherit;
}

.marge-tab:hover { color: #6D071A; background: #fafafa; }
.marge-tab.active { color: #6D071A; border-bottom-color: #6D071A; }

.marge-tab-content { display: none; padding: 24px 28px; flex: 1; }
.marge-tab-content.active { display: block; }

/* ========================================
   INPUTS (jaune saisie / gris calculé)
======================================== */
.marge-input-yellow {
  background: #FFF8E1 !important;
  border: 1.5px solid #dfc87a !important;
  padding: 9px 12px !important;
  border-radius: 6px !important;
  font-size: 14px !important;
  width: 100%;
  max-width: 150px;
  box-sizing: border-box;
  font-family: inherit;
  transition: all 0.2s;
}

.marge-input-yellow:focus {
  outline: none;
  border-color: #6D071A !important;
  box-shadow: 0 0 0 3px rgba(109,7,26,0.12);
}

.marge-input-gray {
  background: #f1f5f9 !important;
  border: 1.5px solid #e2e8f0 !important;
  padding: 9px 12px !important;
  border-radius: 6px !important;
  font-size: 14px !important;
  max-width: 150px;
  box-sizing: border-box;
  color: #1e293b;
  font-weight: 600;
  font-family: inherit;
}

/* ========================================
   ONGLET LOT(S) — LAYOUT
======================================== */
.marge-lots-grid {
  display: block;
}

.marge-lots-page {
  display: flex;
  flex-direction: column;
  gap: 22px;
}

/* ---- SECTION DÉCISION (pleine largeur, haut) ---- */
.marge-decision {
  width: 100%;
}

.decision-box {
  background: linear-gradient(135deg, #6D071A 0%, #9B1030 100%);
  border: none;
  border-radius: 14px;
  padding: 20px 28px 16px;
  width: 100%;
  box-shadow: 0 4px 16px rgba(109,7,26,0.25);
}

/* Layout 3 zones : KPI | BADGE centré | KPI */
.decision-layout {
  display: flex;
  align-items: center;
  gap: 16px;
}

.decision-side {
  flex: 1;
}

.decision-center {
  flex-shrink: 0;
  display: flex;
  justify-content: center;
}

/* Badge gros et proéminent */
.decision-badge {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 14px 32px;
  border-radius: 12px;
  font-size: 22px;
  font-weight: 800;
  letter-spacing: 0.8px;
  white-space: nowrap;
  min-width: 160px;
  text-align: center;
}

.decision-badge.is-red,
.decision-badge.no-go { background: #fecaca; color: #991b1b; border: 2px solid #dc2626; }
.decision-badge.is-orange,
.decision-badge.reflexion,
.decision-badge.reflexion2,
.decision-badge.orange { background: #fef3c7; color: #92400e; border: 2px solid #d97706; }
.decision-badge.is-green,
.decision-badge.go { background: #bbf7d0; color: #166534; border: 2px solid #16a34a; }

/* KPI cards */
.decision-kpi {
  display: flex;
  flex-direction: column;
  gap: 2px;
  background: rgba(255,255,255,0.10);
  padding: 12px 18px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.12);
  min-width: 140px;
}

.decision-kpi .label { font-size: 11px; color: rgba(255,255,255,0.6); font-weight: 500; }
.decision-kpi .value { font-size: 18px; font-weight: 700; color: #fff; }

/* Critères en ligne sous le layout */
.decision-criteres {
  font-size: 11px;
  color: rgba(255,255,255,0.40);
  margin-top: 12px;
  text-align: center;
  letter-spacing: 0.2px;
}

/* Legacy compat */
.decision-box-header { display: none; }
.decision-badge-row { display: flex; justify-content: center; margin-bottom: 14px; }
.decision-box-kpis { display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 12px; }

/* ---- LOTS WRAPPER ---- */
.lots-wrapper {
  display: flex;
  flex-direction: column;
  gap: 22px;
}

/* ---- LOT CONTAINER (carte blanche) ---- */
.lot-container {
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.06);
  overflow: hidden;
  border: none;
  padding: 0;
}

.lot-container .lot-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 24px;
  background: #f8fafc;
  border-bottom: 2px solid #e5e7eb;
}

.lot-container .lot-header h4 {
  font-size: 17px;
  color: #1e293b;
  margin: 0;
  font-weight: 700;
}

/* ---- GRILLE 3 COLONNES PAR LOT ---- */
.lot-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 18px;
  padding: 20px;
}

.lot-column {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

/* ---- SECTIONS DANS LES COLONNES ---- */
.lot-section {
  background: #fff;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  overflow: hidden;
}

.lot-section h5 {
  margin: 0;
  padding: 10px 14px;
  font-size: 12px;
  font-weight: 700;
  color: #fff;
  letter-spacing: 0.5px;
  text-transform: uppercase;
}

.lot-section .section-body {
  padding: 14px;
}

/* Couleurs headers de section */
.section-descriptifs h5 { background: #4472c4; }
.section-params h5     { background: #5b9bd5; }
.section-vente h5      { background: #70ad47; }
.section-travaux h5    { background: #ed7d31; }
.section-marges h5     { background: #6D071A; }

/* Lignes champ label+input dans les sections */
.lot-section .marge-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

.lot-section .marge-row:last-child { margin-bottom: 0; }

.lot-section .marge-row label {
  font-size: 13px;
  font-weight: 500;
  color: #374151;
  flex: 1;
  min-width: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.lot-section .marge-row input,
.lot-section .marge-row select {
  flex: 0 0 auto;
  width: 130px;
}

/* Ligne total surlignée */
.marge-row-total input.marge-input-gray {
  background: #6D071A !important;
  color: #fff !important;
  font-weight: 700 !important;
  border-color: #6D071A !important;
}

/* ---- SECTION FRAIS DIVERS (pleine largeur) ---- */
.frais-section {
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.06);
  overflow: hidden;
}

.frais-header {
  padding: 14px 24px;
  background: #f8fafc;
  border-bottom: 2px solid #e5e7eb;
}

.frais-header h3 {
  font-size: 14px;
  font-weight: 700;
  color: #1e293b;
  margin: 0;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.frais-body {
  padding: 20px 24px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 10px 24px;
}

.frais-body .marge-row {
  display: flex;
  align-items: center;
  gap: 12px;
}

.frais-body .marge-row label {
  flex: 1;
  font-size: 13px;
  font-weight: 500;
  color: #374151;
  min-width: 180px;
}

/* ========================================
   BARRE D'ACTIONS
======================================== */
.marge-actions {
  display: flex;
  gap: 12px;
  padding: 18px 28px;
  background: #fff;
  border-top: 1px solid #e5e7eb;
  margin-top: auto;
}

.marge-btn {
  padding: 11px 22px;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  font-family: inherit;
}

.marge-btn-primary { background: #6D071A; color: #fff; }
.marge-btn-primary:hover { background: #8B0920; transform: translateY(-1px); }
.marge-btn-secondary { background: #e5e5e5; color: #333; }
.marge-btn-secondary:hover { background: #d1d5db; }
.marge-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; }
.marge-btn-pdf-active { background: #FFB800; color: #111; }
.marge-btn-pdf-active:hover { background: #e6a600; transform: translateY(-1px); }

/* ========================================
   ONGLET RÉCAP
======================================== */
.marge-recap-block {
  margin-bottom: 20px;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  overflow: hidden;
  background: #fff;
}

.marge-recap-block strong {
  display: block;
  padding: 12px 16px;
  background: #f8fafc;
  font-size: 13px;
  color: #1e293b;
  border-bottom: 1px solid #e5e7eb;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.marge-recap-row {
  display: grid;
  grid-template-columns: 280px repeat(5, minmax(100px, 1fr)) 140px;
  gap: 8px;
  padding: 10px 14px;
  border-bottom: 1px solid #f3f4f6;
  font-size: 13px;
  align-items: center;
}

.marge-recap-row:last-child { border-bottom: none; }
.marge-recap-row:nth-child(even) { background: #fafbfc; }
.marge-recap-row .marge-total { font-weight: 700; }
.marge-neg { color: #dc2626 !important; }

/* Colonnes dynamiques récap */
.marge-recap-cols2 .marge-recap-row { grid-template-columns: 1fr 140px; }
.marge-recap-cols4 .marge-recap-row { grid-template-columns: 1fr minmax(90px,1fr) minmax(90px,1fr) 120px; }
.marge-recap-cols5 .marge-recap-row { grid-template-columns: 1fr repeat(2, minmax(90px,1fr)) 120px; }
.marge-recap-cols6 .marge-recap-row { grid-template-columns: 1fr repeat(3, minmax(90px,1fr)) 120px; }
.marge-recap-cols7 .marge-recap-row { grid-template-columns: 1fr repeat(4, minmax(90px,1fr)) 120px; }
.marge-recap-cols8 .marge-recap-row { grid-template-columns: 1fr repeat(5, minmax(90px,1fr)) 120px; }

/* Zone décision dans le récap */
.marge-decision-zone {
  margin-top: 28px;
  padding: 24px;
  background: #f8fafc;
  border-radius: 14px;
  border: 2px solid #e5e7eb;
}

.marge-decision-box {
  padding: 22px 32px;
  border-radius: 14px;
  font-size: 28px;
  font-weight: 800;
  text-align: center;
  margin-bottom: 24px;
  letter-spacing: 1px;
}

.marge-decision-box.no-go { background: #fecaca; color: #991b1b; border: 3px solid #dc2626; }
.marge-decision-box.reflexion,
.marge-decision-box.reflexion2,
.marge-decision-box.orange { background: #fef3c7; color: #92400e; border: 3px solid #d97706; }
.marge-decision-box.go { background: #bbf7d0; color: #166534; border: 3px solid #16a34a; }

.marge-kpi-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 14px;
  margin-bottom: 18px;
}

.marge-kpi-card {
  display: flex;
  flex-direction: column;
  gap: 4px;
  background: #fff;
  padding: 14px 18px;
  border-radius: 10px;
  border: 1px solid #e5e7eb;
}

.marge-kpi-label { font-size: 13px; color: #6b7280; font-weight: 500; }
.marge-kpi-value { font-size: 20px; font-weight: 700; color: #1e293b; }

/* Ancien format (compat) */
.marge-kpi-row {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  font-size: 14px;
}

.marge-criteres { margin-top: 16px; font-size: 13px; color: #6b7280; }
.marge-criteres p { margin: 4px 0; }

.marge-legend { font-size: 14px; margin-bottom: 12px; }

/* ========================================
   MODAL
======================================== */
.marge-modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}

.marge-modal {
  background: #fff;
  border-radius: 16px;
  padding: 32px;
  max-width: 420px;
  width: 90%;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}

.marge-modal h2 { color: #6D071A; margin-bottom: 24px; font-size: 22px; }
.marge-modal .marge-field { margin-bottom: 16px; }
.marge-modal .marge-field label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 6px; color: #374151; }

.marge-modal input, .marge-modal select {
  width: 100%;
  padding: 10px 14px;
  border: 2px solid #e5e5e5;
  border-radius: 8px;
  font-size: 14px;
  font-family: inherit;
  box-sizing: border-box;
}

.marge-modal input:focus, .marge-modal select:focus {
  outline: none;
  border-color: #6D071A;
}

.marge-modal-actions { display: flex; justify-content: flex-end; margin-top: 24px; gap: 12px; }
.marge-error {
  background: #fecaca;
  color: #991b1b;
  padding: 12px;
  border-radius: 8px;
  font-size: 14px;
  margin-bottom: 16px;
  display: none;
}
.marge-error.visible { display: block; }

/* Legacy compat */
.decision-box-lots { width: 100%; }
.readonly-gray {
  background: #f1f5f9 !important;
  border: 1px solid #e2e8f0 !important;
  color: #374151;
}

/* ========================================
   RESPONSIVE
======================================== */

/* Tablettes (<1400px) : 2 colonnes par lot */
@media (max-width: 1400px) {
  .lot-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  .lot-column.col-ef {
    grid-column: 1 / -1;
  }
}

/* Petits écrans (<1024px) */
@media (max-width: 1024px) {
  .marge-historique { width: 220px; min-width: 220px; }
  .lot-grid { grid-template-columns: 1fr; }
  .lot-column.col-ef { grid-column: auto; }
  .frais-body { grid-template-columns: 1fr; }
}

/* Mobile (<768px) */
@media (max-width: 768px) {
  .marge-container { flex-direction: column; }

  .marge-historique {
    width: 100%;
    min-width: 100%;
    height: auto;
    max-height: 200px;
    position: relative;
    top: 0;
  }

  .marge-tab-content { padding: 16px; }
  .marge-tabs { padding: 0 16px; }
  .marge-actions { padding: 14px 16px; flex-wrap: wrap; }

  .decision-box { padding: 16px; }
  .decision-layout { flex-direction: column; gap: 12px; }
  .decision-center { order: -1; }
  .decision-badge { width: 100%; }

  .lot-grid { padding: 14px; gap: 14px; }
  .frais-body { padding: 14px; }

  .lot-section .marge-row { flex-wrap: wrap; }
  .lot-section .marge-row input,
  .lot-section .marge-row select { width: 100%; max-width: none; }
}
